import React, { useEffect,useState } from "react";
import 'bootstrap/dist/css/bootstrap.min.css'; 
import ListCreatedPosts from "../components/ListCreatedPosts";
import maleUser from "../img/profuser.svg";
import { Container,Card,Image,Button } from "react-bootstrap";
import {BsPersonPlusFill} from "react-icons/bs";
import {SiGithub, SiIeee} from "react-icons/si";
import { useSearchParams } from "react-router-dom";
import { api } from "../api";
import { useCookies } from "react-cookie";
import {Link,useLocation} from "react-router-dom";

export default function Profile({user}){    
    const [account,setAccount] = useState([]);
    const location = useLocation()
    const [cookies, setCookie, removeCookie] = useCookies(["user"]);
    const [checkProfile,setCheckProfile] = useState([false]);
     
    
        const {search_id} = location.state;
     console.log(search_id)
    useEffect(() => {
        let isSubscribed = true;
        
        const fetchData = async () => {
          const params = {
            user_id:cookies["UserId"],
            requested_id: search_id?search_id:cookies["UserId"],
          };
          if (!params.user_id) {
            return;
          }

          if(params.requested_id == params.user_id){
            setCheckProfile(true);
           
          } 
          const data = await api.getSelf(params);

          if (isSubscribed) {
            setAccount(data.data);
          }
        };
        fetchData().catch(console.error);
    
        return () => (isSubscribed = false);
      }, [cookies["UserId"]]);

    return(
        <div className="flex mt-32 ml-auto mr-auto max-w-[720px] w-[560px] md:w-[500px] lg:w-[640px]">
            <Container className = "justify-center">
            <Card className="border-0">
            <div style={{ alignItems: "center", display: "flex"}} >
                
            <Image className ="h-26 w-[25%] " floated="left"  src={account.img_url ? account.img_url : maleUser} roundedCircle  />
                
                <div className = "ms-3">
                {!checkProfile && ( 
                <Button className = "hover:bg-[#018451] hover:text-[#FFFFFF]" style = {{float :"right" , backgroundColor: "white", color: "#018ABD", borderRadius: "50%" , padding: "10px" , justifyContent: "center",alignItems:"center" }}><BsPersonPlusFill/></Button>
                )}
                
                <Card.Title className = "text-[#018ABD] text-3xl">{account.name}</Card.Title>
                
                <Card.Subtitle className = "text-[#004581] mt-2 text-base">{account.professional_title}</Card.Subtitle>

                <div className = "mt-4 flex flex-row text-base">
                    <Card.Subtitle className = " me-4">45 Followers</Card.Subtitle>
                    <Card.Subtitle >43 Following</Card.Subtitle>
                </div>
                </div>
            </div>  
            <Card.Text className = "mt-4" >
                {account.about}
            </Card.Text>
            </Card>

            <Card.Title className = "mt-4" >
                Areas of expertise
            </Card.Title>
            <div className = "mt-3 flex align-center">
                <Card.Text className = "align-center me-2"><span className = "bg-[#97CBDC] p-2 font-semibold rounded-xl"> Lorem ipsum </span></Card.Text>
            </div>

            <Card.Title className = "mt-5" >
                Published Papers
            </Card.Title>
            <div className = "mt-3 align-center space-y-4 divide-[#97CBDC] divide-y-2 ">
                <div className = "my-3" ></div>
                
            </div>

            <Card.Title className = "mt-5" >
                Personal Links
            </Card.Title>
            <div className="mt-4">
                <ul>
                {account.show_email  && ( <li className = "m-2 no-underline text-black font-semibold">Email: {account.email}</li> )}
                {account.github_username && (<li><a href= 'https://github.com`/${account.github_username}`' className = "m-2 inline-flex no-underline text-black  font-semibold"><SiGithub size="2.0rem"  /> <span className="ms-2">Github profile: {account.github_username}</span> </a></li>)}
                {account.ieee_id && (<li><a href = "" className = "m-2 inline-flex no-underline text-black font-semibold"><SiIeee size="2.8rem"  /><span className="ms-2 mt-2">IEEE ID: {account.ieee_id}</span></a></li>)}
                </ul>
            </div>

            <ListCreatedPosts profile_id={account.user_id}/>

            {checkProfile && ( 
            <div className="col-md-12 text-center">
            <Link to = '/createpost' className = "btn border-0 my-4 content-center items-center" style = {{background: "#97CBDC"}}> + New Post</Link>
            </div>
            )}
            
            </Container>
            
        </div>
    )
}